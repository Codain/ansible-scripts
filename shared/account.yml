- name: Check if user exists
  action: shell /usr/bin/getent passwd {{ user }}
  register: user_exist
  ignore_errors: True
  changed_when: "user_exist.rc != 0"

- name: init user ${user}
  user: name={{ user }} home=/home/{{ user }}/ shell=/bin/bash uid={{ uid }}
  when: user_exist.changed

- name: init /data/work/ path for ${user}
  file: path=/data/work/{{ user }} state=directory owner={{ user }} group={{ user }}

- name: init ssh key to user ${user}
  authorized_key: user={{ user }} key="{{ item }}"
  with_file:
    - "{{ lookup('env','PWD') }}/public_keys/{{ user }}"
